(function($){	$.xdpuls = function(options){		// инициализируем всего один раз 		if($('body').data('puls')){			$('body').data('puls').fadeIn(500,function(){$(this).find('input').eq(0).focus()});			return false;		}		var settings = {			email:true,			name:true,			theme:true,			message:true,			values:{				email:'',				name:'',				theme:'',				message:'',			},			url:'xdpuls.php',		};		options = $.extend(settings,options);		var e_form = $('<div class="xd_puls"><div class="xd_puls_window">'+				'<div class="err_esc" title="закрыть">x</div>'+				'<div style="clear:both"></div>'+				(options.name?'<div class="xd_puls_tr"><div><input placeholder="Ваше имя" type="text" name="err_name"/></div></div>':'')+				(options.email?'<div class="xd_puls_tr"><div><input placeholder="Ваш email" type="text" name="err_email"/></div></div>':'')+				(options.theme?'<div class="xd_puls_tr"><div><input placeholder="Тема сообщения" type="text" name="err_theme"/></div></div>':'')+				(options.message?'<div class="xd_puls_tr"><div><textarea rows="5" placeholder="Сообщение" type="text" name="err_message"></textarea></div></div>':'')+				'<div class="xd_puls_tr"><div><input type="button" class="btn" name="err_go" value="Отправить"/>&nbsp;<input class="btn err_esc" type="button" value="Отменить"/>&nbsp;<a target="_blank" href="http://xdan.ru" title="Что это?">?</a></div></div>'+			'</div></div>');		$('body').data('puls',e_form).append(e_form);		e_form.find('input[name=err_go]').click(function(){			e_form.find('input').attr('disable',true);			var fld = ['name','email','theme','message',];			var fl = false;			var vals = {};			for(var k in fld){				if(options[fld[k]]&&e_form.find('[name=err_'+fld[k]+']').val().length<3){					e_form.find('[name=err_'+fld[k]+']').focus();					fl = true;					break;				}else{					vals[fld[k]] = options[fld[k]]?e_form.find('[name=err_'+fld[k]+']').val():options.values[fld[k]];				}			}			!fl && $.post(options.url,vals,function(data,status){				if(status="success" && data.error==0){					e_form.find('.xd_puls_window').html('<div class="success_box">Сообщение благополучно отправлено. Спасибо за Ваше участие.</div>');					setTimeout(function(){						e_form.fadeOut(500,function(){							e_form.empty();							$('body').data('puls',0);						});					},2000);				}else{					alert(data.msg);				}			},'json');		});		e_form.find('.err_esc').click(function(){			e_form.fadeOut(500);		});		e_form.keypress(function(evnt){			if(evnt.keyCode==27){				e_form.fadeOut();			}		})				e_form.fadeIn(500,function(){			e_form.find('input').eq(0).focus();		});	}})(jQuery);